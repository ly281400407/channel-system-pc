<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>登陆</title>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <script src="../../js/jquery-3.2.1.js"></script>
    <script>
        if (window.module) module = window.module;
    </script>
    <title>员工登录</title>
    <link rel="stylesheet" href="../../css/login/login.css">
</head>

<body>
    <div class="container">
        <ul class="right">
            <li class="we_login">微信登录</li>
            <li>
                <img src="../../img/QR_code.png">
            </li>
            <li class="scan">
                <span>请用微信扫描二维码登录</span>
                <span>“悦商云”</span>
            </li>
            <li class="more">
                <b></b> 更多登录方式
                <b></b>
            </li>
            <li class="cut">
                <a id="acc">
                <img src="../../img/login_icon.png">
                <span>帐号密码登录</span>
            </a>
                <a class="regis">
                <img src="../../img/sign_icon.png">
                <span>立即注册</span>
            </a>
            </li>
        </ul>
        <ul class="account  hidden">
            <li class="logo">
                <img src="../../img/logo.png">
                <span>企业登录</span>
            </li>
            <li><span id="msg" style="color:red;"></span></li>
            <li>
                <input autocomplete="off" class="user" placeholder="账号">
                <input autocomplete="off" class="pwd" placeholder="密码">
            </li>
            <li class="pwd-controll">
                <span class="float-right">
                <a>忘记密码</a>
            </span>
                <span><b class="radius"></b><input type="checkbox" class="hidden">记住密码</span>
            </li>
            <li>
                <a class="login" id="land">登 录</a>
            </li>
            <li class="cut-ac">
                <a id="qr_code">二维码登录</a>
                <b></b>
                <a id="registerBtn" class="regis">立即注册</a>
            </li>
        </ul>
        <img src="../../img/big_banner.png" class="banner">
    </div>

    <script src="../../js/login.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".regis").click(function(){
                window.open ('register.html','newwindow','height=786,width=1208,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no, location=no,status=no') 
            });

            $("#land").click(function(){
                var username = $(".user").val();
                var pwd = $(".pwd").val();
                if(username == ""){
                    $("#msg").html("账号不能为空");
                    return;
                }
                if(pwd == ""){
                    $("#msg").html("密码不能为空");
                    return;
                }
                tenantLogin(username,pwd);
            });

            $(".user").focus(function(){
                $("#msg").html("");
            });

            $(".pwd").focus(function(){
                $("#msg").html("");
            });

}
        )

        function tenantLogin(username, pwd) {
            $.ajax({
                type: "GET",    //请求方式
                async: true,    //是否异步
                url: "http://localhost:8080/tenant",
                //dataType: "jsonp",    //跨域json请求一定是jsonp
                //jsonp:"callbackone",
                //jsonpCallback:"successCallback",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
                data: {
                    //请求参数
                    userName: username,
                    password: pwd
                },    
                beforeSend: function () {
                    //请求前的处理
                },
                success: function (data) {
                    if(data.meta.success){
                        var Data = data.data;
                        if(Data.dbName!=null){
                            //跳到主页面
                            window.location.href="main.html";
                        }else{
                            //跳到完善信息页面
                            window.location.href="register.html?perfectInfo=true";
                        }
                        
                    }else{
                        // alert(data.meta.msg);
                        $("#msg").html(data.meta.message);
                    }
                    
                },
                complete: function () {
                    // 请求完成的处理,跳到主页面
                },
                error: function () {
                    //请求出错处理
                    console.log("登录失败");
                }
            });
        }
    </script>
</body>

</html>