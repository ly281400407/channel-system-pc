<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>注册</title>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <script src="../../js/jquery-3.2.1.js"></script>
    <script>
        if (window.module) module = window.module;
    </script>
    <link rel="stylesheet" href="../../css/login/register.css">
</head>

<body>
    <div class="container">
        <ul class="regt">
            <div class="close" onclick="window.close()"></div>
            <li class="logo">
                <span>欢迎注册悦商云</span>
            </li>
            <li class="position">
                <input id="account" autocomplete="off" length class="user" placeholder="请输入账号">
                <input id="pwd" type="password" autocomplete="off" class="pwd" placeholder="请输入密码">
                <input id="phonenumber" autocomplete="off" placeholder="手机号码">
                <input id="verifyCode" autocomplete="off" placeholder="手机验证码">
                <a id="getVerifyCode" class="getbtn">获取</a>
            </li>
            <li>
                <a class="login" id="register">注&nbsp;册</a>
            </li>
        </ul>
        <ul class="complate hidden">
            <div class="close" onclick="window.close()"></div>
            <li class="success">
                <span class="hint">恭喜你！注册成功</span>
                <span>请完善你的店铺信息，即刻开始收银！</span>
            </li>
            <li class="position">
                <input autocomplete="off" id="user" class="user" placeholder="店名">
                <input autocomplete="off" id="province" class="adr" placeholder="省" readonly>
                <input type="hidden" autocomplete="off" id="city" class="adr" placeholder="市" readonly>
                <input type="hidden" autocomplete="off" id="county" class="adr" placeholder="县" readonly>
                <input autocomplete="off" id="adrDetail" placeholder="详细地址">
                <input autocomplete="off" id="industry" class="industry" placeholder="行业" readonly>
                <input autocomplete="off" id="email" placeholder="邮箱">
                <div class="address hidden">
                    <ul>
                        <li>广东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                        <li>山东省</li>
                        <li>河南省</li>
                        <li>湖南省</li>
                    </ul>
                    <ul>
                        <li>广州市</li>
                        <li>深圳市</li>
                        <li>珠海市</li>
                        <li>汕头市</li>
                        <li>韶关市</li>
                        <li>佛山市</li>
                        <li>江门市</li>
                        <li>湛江市</li>
                        <li>茂名市</li>
                        <li>肇庆市</li>
                        <li>肇庆市</li>
                        <li>惠州区</li>
                        <li>梅州区</li>
                        <li>汕尾区</li>
                        <li>河源区</li>
                        <li>阳江区</li>
                        <li>清远区</li>
                        <li>东莞区</li>
                    </ul>
                    <ul class="area">
                        <li>福田区</li>
                        <li>罗湖区</li>
                        <li>南山区</li>
                        <li>宝安区</li>
                        <li>龙岗区</li>
                        <li>盐田区</li>
                        <li>其他</li>
                    </ul>
                </div>
                <div class="indu hidden">
                    <ul>
                        <li value="1">计算机/互联网/通信/电子</li>
                        <li value="2">会计/金融/银行/保险</li>
                        <li value="3">会计/金融/银行/保险</li>
                        <li value="4">贸易/消费/制造/营运</li>
                        <li value="5">制药/医疗</li>
                        <li value="6">广告/媒体</li>
                        <li>房地产/建筑</li>
                        <li>专业服务/教育/培训</li>
                        <li>服务业</li>
                        <li>物流/运输</li>
                        <li>能源/原材料</li>
                        <li>政府/非赢利机构/其他</li>
                    </ul>
                </div>
            </li>
            <li>
                <a class="login" id="startUse">开始使用</a>
            </li>
        </ul>
        <img src="../../img/banner.png" class="banner">
    </div>

    <script src="../../js/login.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var tenantAcc = null;
            var perfectInfo = getValue("perfectInfo");
            if (perfectInfo != null && perfectInfo == "true") {
                $(".hint").html("");
                $(".regt").addClass("hidden");
                $(".complate").removeClass("hidden");
            }

            $("#getVerifyCode").click(function () {
                var phonenumber = $("#phonenumber").val();
                //var reg = /^1[0-9]{10}$/;
                var reg = /^1[3|4|5|7|8][0-9]{9}$/;
                if (!reg.test($("#phonenumber").val())) {
                    alert('请输入有效的手机号码！');
                    return false;
                }
                if (phonenumber == "" || phonenumber == null) {
                    document.getElementById("getVerifyCode").disabled = true;
                    alert("请输入手机号");
                    return false;
                } else {
                    getVerifyCode(phonenumber);
                }

            });

            $("#register").click(function () {
                var account = $("#account").val();
                tenantAcc = $("#account").val();
                var pwd = $("#pwd").val();
                var phonenumber = $("#phonenumber").val();
                var verifycode = $("#verifyCode").val();

                var ok = /^[a-zA-Z][a-zA-Z0-9]*$/.test(account);
                if(!ok) {
                    alert('对不起，请输入以字母开头的账号'); return false;
                }

                if (account.length < 6) {
                    alert('对不起，请输入不小于六位的账号');
                    return false;
                }
                if (pwd.length < 6) {
                    alert('对不起，您的密码不能小于六位');
                    return false;
                }
                var reg = /^1[3|4|5|7|8][0-9]{9}$/;
                if (!reg.test($("#phonenumber").val())) {
                    alert('请输入有效的手机号码！');
                    return false;
                }
                if (verifycode == "" || verifycode == null) {
                    alert("请填写验证码");
                    return false;
                }
                userRegister(account, pwd, phonenumber, verifycode);
            });

            $("#startUse").click(function () {
                var tenantAccount = getValue("tenantAccount");
               // alert(tenantAccount);
                if(tenantAccount==""){
                    tenantAccount = tenantAcc;
                }
                var companyName = $("#user").val();
                var province = $("#province").val();
                //var city = $("#city").val();
                //var county = $("#county").val();
                var city = "深圳";
                var county = "南山";
                var adrdetail = $("#adrDetail").val();
                var industry = $("#industry").attr("val");
                var email = $("#email").val();
                if (companyName == "" || companyName == null) {
                    alert("请输入店铺名");
                    return false;
                }
                if (province == "" || province == null || city == "" || city == null || county == "" || county == null) {
                    alert("请选择所在区域");
                    return false;
                }
                if (adrdetail == "" || adrdetail == null) {
                    alert("请填写详细地址");
                    return false;
                }
                if (industry == "" || industry == null) {
                    alert("请选择行业");
                    return false;
                }
                if (email == "" || email == null) {
                    alert("请输入邮件地址");
                    return false;
                }

                startUse(tenantAccount, companyName, province, city, county, adrdetail, industry, email);


            });

        })

        function startUse(tenantAccount, companyName, province, city, county, adrdetail, industry, email) {
            $.ajax({
                type: "PUT",    //请求方式
                async: true,    //是否异步
                url: baseUrl + "/tenant",
                // dataType: "jsonp",    //跨域json请求一定是jsonp
                //jsonp:"callbackone",
                //jsonpCallback:"successCallback",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
                data: {
                    tenantAccount: tenantAccount,
                    companyName: companyName,
                    province: province,
                    city: city,
                    county: county,
                    address: adrdetail,
                    tenantType: industry,
                    email: email
                },    //请求参数
                beforeSend: function () {
                    //请求前的处理
                },
                success: function (data) {
                    if (data.meta.success) {
                        window.location.href = "main.html";
                    }
                    /* if (data.user != null) {
                        $("#queryUser").html(data.user);
                        $("#queryPassword").html(data.password);
                    } else {
                        $("#queryUser").html("");
                        $("#queryPassword").html("");
                    } */
                },
                complete: function () {
                    //请求完成的处理
                },
                error: function () {
                    //请求出错处理
                }
            });
        }
        function getVerifyCode(phonenumber) {
            $.ajax({
                type: "get",    //请求方式
                async: true,    //是否异步
                url: baseUrl + "/verificationCode",
                // dataType: "jsonp",    //跨域json请求一定是jsonp
                //jsonp:"callbackone",
                //jsonpCallback:"successCallback",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
                data: {
                    phone: phonenumber
                },    //请求参数
                beforeSend: function () {
                    //请求前的处理
                },
                success: function (data) {
                    /* if (data.user != null) {
                        $("#queryUser").html(data.user);
                        $("#queryPassword").html(data.password);
                    } else {
                        $("#queryUser").html("");
                        $("#queryPassword").html("");
                    } */
                },
                complete: function () {
                    //请求完成的处理
                },
                error: function () {
                    //请求出错处理
                }
            });
        }
        function userRegister(account, pwd, phonenumber, verifycode) {
            $.ajax({
                type: "POST",    //请求方式
                async: true,    //是否异步
                url: baseUrl + "/tenant",
                //dataType: "jsonp",    //跨域json请求一定是jsonp
                //jsonp:"callbackone",
                //jsonpCallback:"successCallback",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
                data: {
                    accountName: account,
                    pwd: pwd,
                    phone: phonenumber,
                    verificationCode: verifycode
                },    //请求参数
                beforeSend: function () {
                    //请求前的处理
                },
                success: function (data) {
                    if (data.meta.success) {
                        //请求完成的处理
                        $(".regt").addClass("hidden");
                        $(".complate").removeClass("hidden");
                        console.log("注册成功");
                    } else {
                        alert(data.meta.message);
                    }
                },
                complete: function () {
                    //请求完成的处理

                },
                error: function () {
                    //请求出错处理
                    console.log("注册失败");
                }
            });
        }

        function getValue(name) {
            var str = window.location.search;
            if (str.indexOf(name) != -1) {
                var pos_start = str.indexOf(name) + name.length + 1;
                var pos_end = str.indexOf("&", pos_start);
                if (pos_end == -1) {
                    return str.substring(pos_start);
                } else {
                    return str.substring(pos_start, pos_end)
                }
            }
            else {
                return "";
            }
        }
    </script>
</body>

</html>